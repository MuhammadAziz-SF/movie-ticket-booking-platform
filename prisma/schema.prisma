datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  admin
  super_admin
  user
}

enum SeatType {
  STANDARD
}

enum BookingStatus {
  PENDING
}

enum PaymentStatus {
  PENDING
  completed
  cancelled
}

model Admin {
  id        String   @id @default(uuid())
  fullName  String
  email     String   @unique
  password  String
  phone     String   @unique
  role      UserRole @default(admin)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  fullName  String
  phone     String
  role      UserRole @default(user)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings Booking[]
}

model Theater {
  id        String   @id @default(uuid())
  name      String
  address   String
  city      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  screens Screen[]
}

model Screen {
  id        String   @id @default(uuid())
  name      String
  capacity  Int
  theaterId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  theater   Theater    @relation(fields: [theaterId], references: [id])
  seats     Seat[]
  showtimes Showtime[]

  @@index([theaterId])
}

model Seat {
  id        String   @id @default(uuid())
  row       String
  number    Int
  type      SeatType @default(STANDARD)
  screenId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  screen  Screen   @relation(fields: [screenId], references: [id])
  tickets Ticket[]

  @@unique([screenId, row, number])
}

model Movie {
  id                String   @id @default(uuid())
  title             String
  description       String
  releaseDate       DateTime
  durationInMinutes Int
  posterUrl         String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  showtimes Showtime[]
}

model Showtime {
  id         String   @id @default(uuid())
  startTime  DateTime
  basePrice  Decimal  @db.Decimal(10, 2)
  movieId    String
  screenId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  movie    Movie    @relation(fields: [movieId], references: [id])
  screen   Screen   @relation(fields: [screenId], references: [id])
  bookings Booking[]

  @@index([startTime])
  @@index([movieId])
  @@index([screenId])
}

model Booking {
  id          String        @id @default(uuid())
  status      BookingStatus @default(PENDING)
  totalAmount Decimal       @db.Decimal(10, 2)
  expiresAt   DateTime
  userId      String
  showtimeId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user     User     @relation(fields: [userId], references: [id])
  showtime Showtime @relation(fields: [showtimeId], references: [id])
  tickets  Ticket[]
  payments Payment[]

  @@index([status])
  @@index([userId])
  @@index([showtimeId])
}

model Ticket {
  id         String  @id @default(uuid())
  price      Decimal @db.Decimal(10, 2)
  bookingId  String
  seatId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  booking Booking @relation(fields: [bookingId], references: [id])
  seat    Seat    @relation(fields: [seatId], references: [id])

  @@unique([bookingId, seatId])
  @@index([seatId])
}

model Payment {
  id            String        @id @default(uuid())
  amount        Decimal       @db.Decimal(8, 2)
  paymentMethod String
  transactionId String        @unique
  status        PaymentStatus @default(PENDING)
  bookingId     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  booking Booking @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
}
